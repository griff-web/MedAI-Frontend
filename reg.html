<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Create Account | Med-AI</title>
<meta name="description" content="Join MedAI for secure, AI-powered medical image analysis.">

<!-- Favicon -->
<link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQdQRHGEmi5WbR1z9s2efKq33kxiId0ir2_dg&s">

<!-- PWA manifest -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<!-- Apple PWA support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="MedAI">

<!-- Stylesheets -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="auth.css">

<!-- Scripts -->
<script>
   window.ENV_API_BASE = "https://medai-backend-j9i6.onrender.com";
   window.ENV_GOOGLE_CLIENT_ID = "1083572515625-2f35o2d9fl3g0sqbhemkus0tkqh13pgk.apps.googleusercontent.com";
</script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="auth.js" defer></script>

</head>

<body>
<!-- Skip to main content for accessibility -->
<a href="#main-content" class="skip-to-main">Skip to main content</a>

<div id="notification" class="notification hidden" role="status" aria-live="polite"></div>

<main class="auth-container" id="main-content">
    <section class="auth-card">
        <header class="auth-header">
            <div class="logo" aria-label="MedAI Logo">Med<span>AI</span></div>
            <h1>Create Your Account</h1>
            <p>Secure access to AI-powered medical image analysis</p>
        </header>

        <!-- GOOGLE SIGN-UP -->
        <div class="social-auth">
            <div id="google-signin-btn" aria-label="Sign up with Google"></div>
        </div>

        <div class="divider" role="separator" aria-label="or">
            <span>or sign up with email</span>
        </div>

        <!-- LOCAL REGISTER FORM -->
        <form id="form-register" novalidate>
            <!-- Full Name Field -->
            <div class="form-group" id="name-group">
                <label for="fullname">
                    <i class="fas fa-user" aria-hidden="true"></i>
                    Full Name
                </label>
                <input 
                    type="text" 
                    id="fullname" 
                    name="fullname" 
                    required 
                    autocomplete="name" 
                    placeholder="Dr. John Doe"
                    aria-required="true"
                    aria-describedby="name-help name-error"
                    minlength="2"
                    maxlength="50"
                >
                <div class="validation-icon" aria-hidden="true"></div>
                <div id="name-help" class="form-helper">Enter your full legal name as registered with medical board</div>
                <div id="name-error" class="error-message" role="alert"></div>
            </div>

            <!-- Email Field -->
            <div class="form-group" id="email-group">
                <label for="email">
                    <i class="fas fa-envelope" aria-hidden="true"></i>
                    Email Address
                </label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    required 
                    autocomplete="email" 
                    placeholder="name@hospital.com"
                    aria-required="true"
                    aria-describedby="email-help email-error"
                >
                <div class="validation-icon" aria-hidden="true"></div>
                <div id="email-help" class="form-helper">Use your professional/hospital email address</div>
                <div id="email-error" class="error-message" role="alert"></div>
            </div>

            <!-- Role Selection -->
            <div class="form-group" id="role-group">
                <label for="role">
                    <i class="fas fa-stethoscope" aria-hidden="true"></i>
                    Practitioner Role
                </label>
                <select id="role" name="role" class="form-input" aria-describedby="role-help">
                    <option value="user">General Practitioner</option>
                    <option value="doctor">Radiologist</option>
                    <option value="admin">Hospital Admin</option>
                </select>
                <div id="role-help" class="form-helper">Select your primary role in the healthcare system</div>
            </div>

            <!-- Password Field with Strength Meter -->
            <div class="form-group" id="password-group">
                <label for="password">
                    <i class="fas fa-lock" aria-hidden="true"></i>
                    Password
                </label>
                <div class="password-wrapper">
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        autocomplete="new-password"
                        aria-required="true"
                        aria-describedby="password-help password-error password-requirements"
                        minlength="8"
                    >
                    <button type="button" class="toggle-password" aria-label="Toggle password visibility" aria-pressed="false">
                        <i class="fas fa-eye" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="validation-icon" aria-hidden="true"></div>
                
                <!-- Password Strength Meter -->
                <div class="password-strength" id="password-strength">
                    <div class="strength-meter" aria-label="Password strength">
                        <div class="strength-segment" id="strength-1"></div>
                        <div class="strength-segment" id="strength-2"></div>
                        <div class="strength-segment" id="strength-3"></div>
                        <div class="strength-segment" id="strength-4"></div>
                    </div>
                    <span class="strength-text" id="strength-text">Enter password</span>
                </div>

                <!-- Password Requirements List -->
                <div class="password-requirements" id="password-requirements" role="list" aria-label="Password requirements">
                    <p>Password must contain:</p>
                    <ul>
                        <li id="req-length" class=" unmet">
                            <i class="fas fa-times-circle" aria-hidden="true"></i>
                            <span>At least 8 characters</span>
                        </li>
                        <li id="req-uppercase" class=" unmet">
                            <i class="fas fa-times-circle" aria-hidden="true"></i>
                            <span>At least one uppercase letter</span>
                        </li>
                        <li id="req-lowercase" class=" unmet">
                            <i class="fas fa-times-circle" aria-hidden="true"></i>
                            <span>At least one lowercase letter</span>
                        </li>
                        <li id="req-number" class=" unmet">
                            <i class="fas fa-times-circle" aria-hidden="true"></i>
                            <span>At least one number</span>
                        </li>
                        <li id="req-special" class=" unmet">
                            <i class="fas fa-times-circle" aria-hidden="true"></i>
                            <span>At least one special character (!@#$%^&*)</span>
                        </li>
                    </ul>
                </div>
                <div id="password-error" class="error-message" role="alert"></div>
            </div>

            <!-- Confirm Password Field (Optional but recommended) -->
            <div class="form-group" id="confirm-password-group">
                <label for="confirm-password">
                    <i class="fas fa-lock" aria-hidden="true"></i>
                    Confirm Password
                </label>
                <div class="password-wrapper">
                    <input 
                        type="password" 
                        id="confirm-password" 
                        name="confirm-password" 
                        autocomplete="off"
                        aria-describedby="confirm-password-error"
                    >
                    <button type="button" class="toggle-password" aria-label="Toggle password visibility" aria-pressed="false">
                        <i class="fas fa-eye" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="validation-icon" aria-hidden="true"></div>
                <div id="confirm-password-error" class="error-message" role="alert"></div>
            </div>

            <!-- Terms and Conditions -->
            <div class="form-consent">
                <label class="checkbox-container">
                    <input type="checkbox" id="terms" name="terms" required aria-required="true" aria-describedby="terms-error">
                    <span class="checkmark" aria-hidden="true"></span>
                    <span class="label-text">
                        I agree to the <a href="#" class="terms-link" tabindex="0">Terms of Service</a> and 
                        <a href="#" class="privacy-link" tabindex="0">Privacy Policy</a>
                    </span>
                </label>
                <div id="terms-error" class="error-message" role="alert"></div>
            </div>

            <!-- Submit Button with Loading State -->
            <button type="submit" class="btn-primary" id="submitBtn">
                <span class="btn-text">Create Account</span>
                <span class="loader" style="display: none;"></span>
            </button>

            <!-- Form Status Messages -->
            <div id="form-status" class="form-status" role="status" aria-live="polite"></div>
        </form>

        <footer class="auth-footer">
            <p>
                Already registered? 
                <a href="login.html" class="back-link">
                    <span aria-hidden="true">→</span>
                    Sign in
                </a>
            </p>
        </footer>
    </section>

    <!-- Success Modal (Hidden by default) -->
    <div id="success-modal" class="modal hidden" role="dialog" aria-labelledby="modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="success-icon" aria-hidden="true">✓</div>
            <h2 id="modal-title">Registration Successful!</h2>
            <p>Your account has been created. Redirecting to dashboard...</p>
            <div class="loading-spinner"></div>
        </div>
    </div>
</main>

<!-- PWA Service Worker Registration -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js")
      .then(registration => {
        console.log("✅ Service Worker registered successfully:", registration.scope);
      })
      .catch(err => {
        console.error("❌ Service Worker registration failed:", err);
        // Show offline warning but don't block registration
        const notification = document.getElementById('notification');
        if (notification) {
            notification.textContent = "App may not work offline";
            notification.className = "notification visible warning";
            setTimeout(() => notification.classList.remove('visible'), 3000);
        }
      });
  });
}

// Prevent double-tap zoom on buttons for better mobile experience
document.addEventListener('touchstart', (e) => {
    if (e.target.closest('button')) {
        e.preventDefault();
    }
}, { passive: false });
</script>

<!-- Inline validation script for immediate feedback -->
<script>
// This enhances the auth.js functionality with real-time validation
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirm-password');
    const strengthSegments = document.querySelectorAll('.strength-segment');
    const strengthText = document.getElementById('strength-text');
    
    // Password requirement elements
    const reqLength = document.getElementById('req-length');
    const reqUppercase = document.getElementById('req-uppercase');
    const reqLowercase = document.getElementById('req-lowercase');
    const reqNumber = document.getElementById('req-number');
    const reqSpecial = document.getElementById('req-special');

    if (passwordInput) {
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            
            // Check requirements
            const hasLength = password.length >= 8;
            const hasUppercase = /[A-Z]/.test(password);
            const hasLowercase = /[a-z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
            
            // Update requirement indicators
            updateRequirement(reqLength, hasLength);
            updateRequirement(reqUppercase, hasUppercase);
            updateRequirement(reqLowercase, hasLowercase);
            updateRequirement(reqNumber, hasNumber);
            updateRequirement(reqSpecial, hasSpecial);
            
            // Calculate strength
            const strength = [hasLength, hasUppercase, hasLowercase, hasNumber, hasSpecial].filter(Boolean).length;
            
            // Update strength meter
            updateStrengthMeter(strength);
            
            // Check password match
            if (confirmInput && confirmInput.value) {
                checkPasswordMatch();
            }
        });
    }

    if (confirmInput) {
        confirmInput.addEventListener('input', checkPasswordMatch);
    }

    function updateRequirement(element, met) {
        if (!element) return;
        
        const icon = element.querySelector('i');
        if (met) {
            element.classList.remove('unmet');
            element.classList.add('met');
            if (icon) {
                icon.className = 'fas fa-check-circle';
            }
        } else {
            element.classList.remove('met');
            element.classList.add('unmet');
            if (icon) {
                icon.className = 'fas fa-times-circle';
            }
        }
    }

    function updateStrengthMeter(strength) {
        const segments = document.querySelectorAll('.strength-segment');
        const strengthLabels = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong'];
        
        segments.forEach((segment, index) => {
            segment.classList.remove('weak', 'medium', 'strong');
            if (index < strength) {
                if (strength <= 2) {
                    segment.classList.add('weak');
                } else if (strength <= 4) {
                    segment.classList.add('medium');
                } else {
                    segment.classList.add('strong');
                }
            }
        });
        
        if (strengthText) {
            strengthText.textContent = strengthLabels[strength] || strengthLabels[0];
        }
    }

    function checkPasswordMatch() {
        const password = passwordInput?.value || '';
        const confirm = confirmInput?.value || '';
        const errorEl = document.getElementById('confirm-password-error');
        const group = document.getElementById('confirm-password-group');
        
        if (confirm && password !== confirm) {
            errorEl.textContent = 'Passwords do not match';
            group?.classList.add('error');
            group?.classList.remove('success');
        } else if (confirm && password === confirm) {
            errorEl.textContent = '';
            group?.classList.remove('error');
            group?.classList.add('success');
        } else {
            errorEl.textContent = '';
            group?.classList.remove('error', 'success');
        }
    }

    // Terms links modal simulation (for demo)
    document.querySelectorAll('.terms-link, .privacy-link').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            alert('Terms and Privacy Policy would open here. In production, this would link to your actual policy pages.');
        });
    });
});
</script>

</body>
</html>
