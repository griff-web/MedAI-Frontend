<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedAI | Clinical Portal</title>
    <link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQdQRHGEmi5WbR1z9s2efKq33kxiId0ir2_dg&s">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #008C51;
            --secondary: #1a3a5f;
            --accent: #48bb78;
            --bg: #f8fafc;
            --white: #ffffff;
            --text: #2d3748;
            --glass: rgba(255, 255, 255, 0.9);
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar for Vitals */
        .sidebar {
            width: 280px;
            background: var(--secondary);
            color: white;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 4px 0 15px rgba(0,0,0,0.1);
        }

        .vitals-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid var(--accent);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Modern Header */
        header {
            background: var(--white);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
        }

        .doctor-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--accent);
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        /* Chat Layout */
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: url('https://www.toptal.com/designers/subtlepatterns/patterns/medical-pattern.png');
        }

        .msg {
            max-width: 70%;
            padding: 18px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.6;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            position: relative;
        }

        .bot-msg {
            background: var(--white);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            color: var(--text);
        }

        .user-msg {
            background: var(--primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        /* Input Controls */
        .input-area {
            background: var(--white);
            padding: 25px;
            display: flex;
            gap: 15px;
            border-top: 1px solid #e2e8f0;
        }

        input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #edf2f7;
            border-radius: 12px;
            font-size: 16px;
            transition: 0.3s;
        }

        input:focus { border-color: var(--primary); outline: none; }

        .btn {
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-pdf { background: #edf2f7; color: var(--secondary); }
        .btn:hover { opacity: 0.85; transform: translateY(-1px); }

        .typing { font-size: 13px; color: #718096; margin-left: 35px; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="margin: 0; font-size: 22px;"><i class="fas fa-stethoscope"></i> Patient Log</h2>
    <hr style="opacity: 0.2; width: 100%;">
    
    <div class="vitals-card">
        <small>LAST ASSESSMENT</small>
        <div style="font-size: 18px; margin-top: 5px;">Risk Level: <span id="risk-display">Normal</span></div>
    </div>

    <div class="vitals-card">
        <small>DETECTED SYMPTOMS</small>
        <div id="symptom-list" style="font-size: 14px; margin-top: 5px; opacity: 0.8;">None recorded...</div>
    </div>

    <div style="margin-top: auto;">
        <p style="font-size: 11px; opacity: 0.6; line-height: 1.4;">
            <i class="fas fa-info-circle"></i> This AI assistant uses a clinical database of 100+ conditions. Not a substitute for a physical exam.
        </p>
    </div>
</div>

<div class="main-content">
    <header>
        <div class="doctor-info">
            <a href="dash.html" style="text-decoration: none; color: var(--secondary);"><i class="fas fa-chevron-left"></i></a>
            <div style="width: 45px; height: 45px; background: #e2e8f0; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-user-md fa-lg" style="color: var(--primary);"></i>
            </div>
            <div>
                <div style="font-weight: 700; font-size: 16px;">Dr. MedAI Clinical Support</div>
                <div style="font-size: 12px; color: var(--accent);"><span class="status-dot"></span> Secure Line Active</div>
            </div>
        </div>
        <button class="btn btn-pdf" onclick="exportPDF()">
            <i class="fas fa-file-export"></i> Save Case Report
        </button>
    </header>

    <div id="chat-container">
        <div class="msg bot-msg">
            Good day. I am the MedAI clinical assistant. I'm here to help you understand your symptoms. 
            <br><br>
            Please describe how you are feeling in your own words.
        </div>
    </div>

    <div id="typing-indicator" class="typing">
        <i class="fas fa-circle-notch fa-spin"></i> Dr. MedAI is analyzing clinical patterns...
    </div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="E.g. I have a sharp pain in my lower right abdomen and a fever...">
        <button class="btn btn-primary" onclick="handleInput()">
            Send Analysis <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>

<script>
    // Logic is integrated into a single "Medical Brain"
    const medicalLibrary = {
        // [Your 100+ Library from the previous step goes here]
        "Appendicitis": ["lower right pain", "navel pain", "loss of appetite", "rebound tenderness", "fever"],
        "Myocardial Infarction (Heart Attack)": ["crushing chest pain", "left arm pain", "jaw pain", "nausea", "cold sweat", "shortness of breath"],
        "Migraine": ["throbbing", "aura", "light sensitivity", "nausea", "sound sensitivity"],
        "GERD": ["heartburn", "acid reflux", "sour taste", "chest burning"],
        "Diabetes": ["excessive thirst", "frequent urination", "blurred vision", "fatigue"],
        "Pneumonia": ["cough", "shortness of breath", "chest pain", "fever", "chills"],
        "UTI": ["burning urination", "frequent urination", "pelvic pain", "cloudy urine"],
        // ... (Include the full 100+ library from previous version here)
    };

    let patientContext = {
        symptoms: new Set(),
        risk: "Low"
    };

    function addMessage(text, sender) {
        const div = document.createElement('div');
        div.className = `msg ${sender}-msg`;
        div.innerHTML = text;
        document.getElementById('chat-container').appendChild(div);
        document.getElementById('chat-container').scrollTop = document.getElementById('chat-container').scrollHeight;
    }

    function handleInput() {
        const val = document.getElementById('user-input').value;
        if(!val) return;
        
        addMessage(val, 'user');
        document.getElementById('user-input').value = '';
        document.getElementById('typing-indicator').style.display = 'block';

        setTimeout(() => {
            document.getElementById('typing-indicator').style.display = 'none';
            generateDoctorResponse(val.toLowerCase());
        }, 1200);
    }

    function generateDoctorResponse(input) {
        // Emergency Check
        if(input.includes("chest pain") || input.includes("can't breathe") || input.includes("slurred speech")) {
            patientContext.risk = "CRITICAL";
            updateSidebar();
            addMessage("<strong>URGENT:</strong> I am identifying signs of a potential medical emergency. Please call emergency services (911/112) immediately. Do not wait.", "bot");
            return;
        }

        // Greeting Check
        if(input.match(/hi|hello|hey|morning/)) {
            addMessage("Hello. I'm ready to assist. Please describe your symptoms, including when they started and their severity.", "bot");
            return;
        }

        // Logic
        let matches = [];
        for (const [disease, symptoms] of Object.entries(medicalLibrary)) {
            let score = 0;
            symptoms.forEach(s => {
                if(input.includes(s.toLowerCase())) {
                    score++;
                    patientContext.symptoms.add(s);
                }
            });
            if(score > 0) matches.push({name: disease, score: score});
        }

        matches.sort((a,b) => b.score - a.score);
        updateSidebar();

        if(matches.length > 0) {
            const primary = matches[0];
            let response = `I've analyzed your symptoms. There is a clinical correlation with <strong>${primary.name}</strong>.`;
            
            if(primary.name === "Appendicitis") {
                response += `<br><br>

[Image of the human digestive system showing the appendix location]
`;
            } else if(primary.name.includes("Heart")) {
                response += `<br><br>

[Image of human heart anatomy]
`;
            }

            response += `<br><br>To be more precise: Are you also experiencing any <em>${getFollowUp(primary.name)}</em>? And on a scale of 1-10, how severe is the discomfort?`;
            addMessage(response, "bot");
        } else {
            addMessage("I hear you. To help me narrow this down, could you tell me if you have a fever, where exactly the discomfort is located, and if anything makes it feel better or worse?", "bot");
        }
    }

    function getFollowUp(disease) {
        const syms = medicalLibrary[disease];
        return syms[Math.floor(Math.random() * syms.length)];
    }

    function updateSidebar() {
        document.getElementById('risk-display').innerText = patientContext.risk;
        document.getElementById('risk-display').style.color = patientContext.risk === "CRITICAL" ? "red" : "#48bb78";
        
        const list = Array.from(patientContext.symptoms).slice(-5);
        document.getElementById('symptom-list').innerHTML = list.length > 0 ? list.join(", ") : "Analyzing...";
    }

    function exportPDF() {
        const element = document.body;
        html2pdf().from(element).save('Clinical_Summary.pdf');
    }

    document.getElementById('user-input').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') handleInput();
    });
</script>

</body>
</html>
