<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedAI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #008C51;
            --secondary: #2A6BCC;
            --bg: #f0f4f8;
            --white: #ffffff;
            --text: #1a202c;
            --danger: #e53e3e;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        header {
            background: var(--white);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .nav-back {
            text-decoration: none;
            color: var(--primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .doctor-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        /* Chat Area */
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .msg {
            max-width: 80%;
            padding: 15px;
            border-radius: 15px;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .bot-msg {
            background: var(--white);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            border-left: 4px solid var(--primary);
        }

        .user-msg {
            background: var(--secondary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        /* Controls */
        .controls {
            background: var(--white);
            padding: 20px;
            display: flex;
            gap: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            outline: none;
            font-size: 16px;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: 0.2s;
        }

        .btn-send { background: var(--primary); color: white; }
        .btn-pdf { background: #edf2f7; color: var(--text); }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }

        .typing { font-size: 12px; color: #718096; margin-left: 5px; display: none; }

        ul { margin: 10px 0; padding-left: 20px; }
        li { margin-bottom: 5px; }
    </style>
</head>
<body>

<header>
    <a href="dash.html" class="nav-back">
        <i class="fas fa-arrow-left"></i> Dashboard
    </a>
    <div class="doctor-profile">
        <div class="avatar"><i class="fas fa-user-md"></i></div>
        <div>
            <div style="font-weight: 700;">Dr. MedAI Assistant</div>
            <div style="font-size: 12px; color: #48bb78;"><i class="fas fa-circle"></i> Active Consultation</div>
        </div>
    </div>
    <button class="btn btn-pdf" onclick="exportPDF()">
        <i class="fas fa-file-pdf"></i> Export
    </button>
</header>

<div id="chat-container">
    <div class="msg bot-msg">
        Hello! I am your clinical assistant. I can help analyze your symptoms and provide information on over 60 medical conditions.
        <br><br><strong>How can I help you today?</strong>
    </div>
</div>

<div id="typing-indicator" class="typing" style="padding: 0 25px 10px;">Dr. MedAI is analyzing...</div>

<div class="controls">
    <input type="text" id="user-input" placeholder="Type your symptoms (e.g., headache and blurred vision)...">
    <button class="btn btn-send" onclick="handleInput()">
        <i class="fas fa-paper-plane"></i>
    </button>
</div>

<script>
    const chatContainer = document.getElementById('chat-container');
    const userInput = document.getElementById('user-input');
    const typingIndicator = document.getElementById('typing-indicator');

    // 60+ Condition Database
    const medicalDatabase = {
        // Respiratory & Infections
        "Common Cold": ["cough", "runny nose", "sneezing", "sore throat", "congestion"],
        "Influenza (Flu)": ["high fever", "body aches", "chills", "severe fatigue"],
        "COVID-19": ["loss of taste", "loss of smell", "dry cough", "fever", "difficulty breathing"],
        "Pneumonia": ["sharp chest pain", "productive cough", "shortness of breath", "shaking chills"],
        "Bronchitis": ["yellow mucus", "wheezing", "tight chest", "fatigue"],
        "Tuberculosis": ["coughing blood", "night sweats", "weight loss", "persistent cough"],
        "Sinusitis": ["facial pressure", "stuffy nose", "thick mucus", "headache"],
        "Streptococcal Pharyngitis": ["swollen tonsils", "white patches in throat", "painful swallowing"],
        
        // Cardiovascular
        "Hypertension": ["pounding in ears", "blurred vision", "nosebleeds", "severe headache"],
        "Angina/Heart Attack": ["crushing chest pain", "left arm pain", "jaw pain", "nausea", "sweating"],
        "Anemia": ["pale skin", "brittle nails", "dizziness", "shortness of breath"],
        "Heart Failure": ["swollen ankles", "fluid retention", "cannot lie flat to breathe"],
        
        // Digestive
        "GERD": ["heartburn", "acid reflux", "sour taste", "chest burning"],
        "Gastroenteritis": ["vomiting", "watery diarrhea", "stomach cramps"],
        "Peptic Ulcer": ["stomach burning", "bloating", "hunger pain"],
        "Appendicitis": ["lower right pain", "rebound tenderness", "nausea", "fever"],
        "Gallstones": ["intense right side pain", "back pain", "pain after fatty meals"],
        "Crohn's Disease": ["abdominal pain", "chronic diarrhea", "weight loss", "rectal bleeding"],
        "Food Poisoning": ["sudden vomiting", "diarrhea", "fever", "weakness"],

        // Neurological & Mental
        "Migraine": ["throbbing head pain", "light sensitivity", "aura", "nausea"],
        "Anxiety Disorder": ["palpitations", "panic", "sweating", "overthinking", "trembling"],
        "Clinical Depression": ["low mood", "loss of interest", "insomnia", "suicidal thoughts"],
        "Vertigo (BPPV)": ["spinning sensation", "dizziness", "unsteadiness"],
        "Meningitis": ["stiff neck", "high fever", "confusion", "rash"],
        "Stroke": ["slurred speech", "facial drooping", "arm weakness", "sudden confusion"],

        // Endocrine & Others
        "Diabetes Type 2": ["excessive thirst", "frequent urination", "slow healing", "blurry vision"],
        "Hypothyroidism": ["weight gain", "cold sensitivity", "dry skin", "constipation"],
        "Hyperthyroidism": ["weight loss", "shaky hands", "rapid heart rate", "bulging eyes"],
        "UTI": ["burning during urination", "cloudy urine", "pelvic pain"],
        "Kidney Stones": ["severe flank pain", "blood in urine", "waves of pain"],
        "Malaria": ["cycling high fever", "shivering", "headache", "sweating"],
        "Dengue": ["behind eye pain", "bone pain", "rash", "high fever"],
        "Lyme Disease": ["bullseye rash", "joint swelling", "fatigue"],
        "Rheumatoid Arthritis": ["morning stiffness", "joint pain", "swollen knuckles"],
        "Gout": ["painful big toe", "swollen joint", "intense redness"],
        "Dehydration": ["dark urine", "dry mouth", "extreme thirst", "sunken eyes"],
        "Insomnia": ["trouble falling asleep", "waking up early", "daytime fatigue"],
        "Heat Stroke": ["confused", "no sweating", "rapid pulse", "faintness"],
        "Eczema": ["itchy skin", "red scaly patches", "dryness"],
        "Asthma": ["wheezing", "chest tightness", "shortness of breath during exercise"]
    };

    function addMessage(content, sender) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `msg ${sender === 'user' ? 'user-msg' : 'bot-msg'}`;
        msgDiv.innerHTML = content;
        chatContainer.appendChild(msgDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function handleInput() {
        const input = userInput.value.trim().toLowerCase();
        if (!input) return;

        addMessage(userInput.value, 'user');
        userInput.value = '';
        
        typingIndicator.style.display = 'block';

        setTimeout(() => {
            typingIndicator.style.display = 'none';
            
            // Conversation Logic
            if (input.match(/^(hi|hello|hey|good morning|good afternoon)/)) {
                addMessage("Hello! I'm ready for your consultation. Please describe your symptoms or how you're feeling.", "bot");
                return;
            }

            if (input.includes("thank")) {
                addMessage("You're very welcome. Is there anything else you'd like to check?", "bot");
                return;
            }

            // Analysis Logic
            let matches = [];
            for (const [disease, symptoms] of Object.entries(medicalDatabase)) {
                let score = 0;
                symptoms.forEach(s => {
                    if (input.includes(s)) score++;
                });
                if (score > 0) matches.push({ name: disease, score: score });
            }

            matches.sort((a, b) => b.score - a.score);

            if (matches.length > 0) {
                let response = `Based on clinical data, your symptoms align with: <br><ul>`;
                matches.slice(0, 3).forEach(m => {
                    response += `<li><strong>${m.name}</strong> (Match strength: ${Math.min(m.score * 25, 100)}%)</li>`;
                });
                response += `</ul><br>Do you have any other symptoms like fever, pain, or dizziness? <br><br><em>Note: This is for info only. Seek emergency care if symptoms are severe.</em>`;
                addMessage(response, "bot");
            } else {
                addMessage("I couldn't find a direct match. Could you be more specific? For example, mention where the pain is or if you have a fever.", "bot");
            }
        }, 800);
    }

    function exportPDF() {
        const element = document.getElementById('chat-container');
        const opt = {
            margin: 1,
            filename: 'Medical_Consultation_Report.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }

    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleInput();
    });
</script>

</body>
</html>
